<!DOCTYPE html>
<html class="light" lang="id">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
    <title>Laporan Perbaikan - Teknisi</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&amp;display=swap"
        rel="stylesheet" />
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#258cf4",
                        "background-light": "#f8fafc",
                        "background-dark": "#0f172a",
                    },
                    fontFamily: {
                        "display": ["Manrope", "sans-serif"]
                    },
                },
            },
        }
    </script>
    <style>
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        body {
            font-family: 'Manrope', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* Signature Canvas */
        #signature-pad {
            touch-action: none;
            cursor: crosshair;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-800 dark:text-slate-100 font-display pb-32">

    <!-- Header -->
    <header
        class="bg-white dark:bg-slate-900 sticky top-0 z-30 shadow-sm border-b border-slate-100 dark:border-slate-800">
        <div class="px-4 py-3 flex items-center gap-3">
            <a href="job-detail.html"
                class="size-10 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-slate-500">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <div>
                <h1 class="font-bold text-lg leading-tight">Laporan Kerja</h1>
                <p class="text-xs text-slate-500">Penyelesaian Tiket #TCK-JOB-001</p>
            </div>
        </div>
    </header>

    <!-- Content -->
    <main class="p-5 space-y-6">

        <!-- Evidence Section -->
        <section>
            <h3 class="font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-lg">photo_camera</span>
                Bukti Foto (Evidence)
            </h3>

            <div class="grid grid-cols-2 gap-4">
                <!-- Before Photo -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Sebelum (Kondisi Awal)</label>
                    <div class="relative aspect-square bg-white dark:bg-slate-800 rounded-2xl border-2 border-dashed border-slate-300 dark:border-slate-600 flex flex-col items-center justify-center text-slate-400 hover:border-primary hover:text-primary transition-colors cursor-pointer group overflow-hidden"
                        onclick="document.getElementById('file-before').click()">
                        <input type="file" id="file-before" class="hidden" accept="image/*"
                            onchange="previewImage(this, 'preview-before')">
                        <img id="preview-before" class="hidden w-full h-full object-cover">
                        <div id="placeholder-before" class="flex flex-col items-center">
                            <span
                                class="material-symbols-outlined text-3xl mb-1 group-hover:scale-110 transition-transform">add_a_photo</span>
                            <span class="text-[10px] font-bold">Upload Foto</span>
                        </div>
                    </div>
                </div>

                <!-- After Photo -->
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2 uppercase">Sesudah (Perbaikan)</label>
                    <div class="relative aspect-square bg-white dark:bg-slate-800 rounded-2xl border-2 border-dashed border-slate-300 dark:border-slate-600 flex flex-col items-center justify-center text-slate-400 hover:border-green-500 hover:text-green-500 transition-colors cursor-pointer group overflow-hidden"
                        onclick="document.getElementById('file-after').click()">
                        <input type="file" id="file-after" class="hidden" accept="image/*"
                            onchange="previewImage(this, 'preview-after')">
                        <img id="preview-after" class="hidden w-full h-full object-cover">
                        <div id="placeholder-after" class="flex flex-col items-center">
                            <span
                                class="material-symbols-outlined text-3xl mb-1 group-hover:scale-110 transition-transform">add_a_photo</span>
                            <span class="text-[10px] font-bold">Upload Foto</span>
                        </div>
                    </div>
                </div>
            </div>
            <p class="text-[10px] text-slate-400 mt-2">*Pastikan foto terlihat jelas dan fokus pada objek perbaikan.</p>
        </section>

        <!-- Technical Report -->
        <section>
            <h3 class="font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-lg">description</span>
                Laporan Teknis
            </h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold mb-2">Tindakan Perbaikan</label>
                    <textarea
                        class="w-full rounded-xl border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm focus:border-primary focus:ring-primary h-24 p-3"
                        placeholder="Contoh: Mengganti kabel patch cord yang putus digigit tikus..."></textarea>
                </div>

                <div>
                    <label class="block text-sm font-bold mb-2">Material Terpakai</label>
                    <div
                        class="bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-1">
                        <div class="flex items-center gap-2 p-2 border-b border-slate-100 dark:border-slate-700">
                            <input type="checkbox" class="rounded text-primary focus:ring-primary border-slate-300">
                            <span class="text-sm">Kabel Fiber (Dropcore)</span>
                            <input type="number" class="w-16 ml-auto rounded-lg border-slate-200 text-xs py-1 px-2"
                                placeholder="Meter">
                        </div>
                        <div class="flex items-center gap-2 p-2 px-2">
                            <input type="checkbox" class="rounded text-primary focus:ring-primary border-slate-300">
                            <span class="text-sm">Konektor RJ45 / Fast Conn</span>
                            <input type="number" class="w-16 ml-auto rounded-lg border-slate-200 text-xs py-1 px-2"
                                placeholder="Pcs">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Signature -->
        <section>
            <h3 class="font-bold text-slate-800 dark:text-white mb-3 flex items-center gap-2">
                <span class="material-symbols-outlined text-primary text-lg">draw</span>
                Tanda Tangan Pelanggan
            </h3>
            <div
                class="bg-white dark:bg-slate-800 rounded-2xl border border-slate-300 dark:border-slate-600 shadow-inner overflow-hidden relative">
                <canvas id="signature-pad" class="w-full h-40 bg-white dark:bg-slate-800"></canvas>
                <div class="absolute bottom-2 right-2">
                    <button type="button" onclick="clearSignature()"
                        class="text-xs bg-slate-200 dark:bg-slate-700 text-slate-600 dark:text-slate-300 px-3 py-1 rounded-lg font-bold hover:bg-slate-300">Hapus</button>
                </div>

                <!-- Placeholder text -->
                <div id="sig-placeholder"
                    class="absolute inset-0 flex items-center justify-center pointer-events-none opacity-30">
                    <span class="text-lg font-bold text-slate-400">Area Tanda Tangan</span>
                </div>
            </div>
            <p class="text-[10px] text-slate-400 mt-2">*Dengan menandatangani ini, pelanggan menyatakan perbaikan telah
                selesai dengan baik.</p>
        </section>

    </main>

    <!-- Floating Submit -->
    <div
        class="fixed bottom-0 left-0 right-0 p-5 bg-white dark:bg-slate-900 border-t border-slate-100 dark:border-slate-800 z-40 backdrop-blur-md bg-opacity-90">
        <button onclick="submitReport()"
            class="w-full bg-green-600 text-white rounded-xl font-bold py-3.5 shadow-lg shadow-green-600/30 flex items-center justify-center gap-2 active:scale-95 transition-transform text-lg">
            <span class="material-symbols-outlined">check_circle</span>
            Selesaikan Tugas
        </button>
    </div>

    <!-- Success Modal Overlay -->
    <div id="success-modal"
        class="fixed inset-0 bg-black/80 z-[100] hidden flex-col items-center justify-center p-6 text-center backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-white dark:bg-slate-800 p-8 rounded-3xl shadow-2xl max-w-sm w-full transform scale-90 transition-transform duration-300"
            id="success-card">
            <div
                class="size-20 bg-green-100 dark:bg-green-900/30 text-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                <span class="material-symbols-outlined text-5xl">check</span>
            </div>
            <h2 class="text-2xl font-bold mb-2">Tugas Selesai!</h2>
            <p class="text-slate-500 mb-8">Laporan telah terkirim dan tiket dinyatakan selesai (Resolved).</p>
            <button onclick="window.location.href='index.html'"
                class="w-full bg-slate-900 dark:bg-slate-700 text-white font-bold py-3 rounded-xl hover:bg-slate-800 transition-colors">
                Kembali ke Dashboard
            </button>
        </div>
    </div>

    <script>
        // Image Preview Logic
        function previewImage(input, previewId) {
            const preview = document.getElementById(previewId);
            const placeholder = document.getElementById(previewId.replace('preview', 'placeholder'));

            if (input.files && input.files[0]) {
                const reader = new FileReader();

                reader.onload = function (e) {
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                    placeholder.classList.add('hidden');
                }

                reader.readAsDataURL(input.files[0]);
            }
        }

        // Signature Pad Logic
        const canvas = document.getElementById("signature-pad");
        const ctx = canvas.getContext("2d");
        const placeholder = document.getElementById("sig-placeholder");
        let writingMode = false;

        // Resize canvas to fit container
        function resizeCanvas() {
            const ratio = Math.max(window.devicePixelRatio || 1, 1);
            canvas.width = canvas.offsetWidth * ratio;
            canvas.height = canvas.offsetHeight * ratio;
            ctx.scale(ratio, ratio);
        }
        window.addEventListener("resize", resizeCanvas);
        resizeCanvas();

        function getTargetPosition(event) {
            const rect = canvas.getBoundingClientRect();
            let clientX = event.clientX;
            let clientY = event.clientY;

            if (event.touches && event.touches.length > 0) {
                clientX = event.touches[0].clientX;
                clientY = event.touches[0].clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        const handlePointerStart = (event) => {
            event.preventDefault(); // Prevent scrolling
            writingMode = true;
            ctx.beginPath();
            const { x, y } = getTargetPosition(event);
            ctx.moveTo(x, y);
            placeholder.style.display = 'none';
        }

        const handlePointerMove = (event) => {
            event.preventDefault();
            if (!writingMode) return;
            const { x, y } = getTargetPosition(event);
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        const handlePointerEnd = () => {
            writingMode = false;
        }

        canvas.addEventListener('mousedown', handlePointerStart);
        canvas.addEventListener('touchstart', handlePointerStart, { passive: false });

        canvas.addEventListener('mousemove', handlePointerMove);
        canvas.addEventListener('touchmove', handlePointerMove, { passive: false });

        canvas.addEventListener('mouseup', handlePointerEnd);
        canvas.addEventListener('touchend', handlePointerEnd);

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            placeholder.style.display = 'flex';
        }

        // Submit Logic
        function submitReport() {
            const btn = document.querySelector('button[onclick="submitReport()"]');
            btn.innerHTML = '<span class="material-symbols-outlined animate-spin">progress_activity</span> Mengirim...';
            btn.classList.add('opacity-70', 'cursor-not-allowed');

            setTimeout(() => {
                const modal = document.getElementById('success-modal');
                const card = document.getElementById('success-card');
                modal.classList.remove('hidden');
                // Trigger reflow
                void modal.offsetWidth;
                modal.classList.add('flex');
                modal.classList.remove('opacity-0');
                card.classList.remove('scale-90');
                card.classList.add('scale-100');
            }, 1500);
        }
    </script>
</body>

</html>